<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Carlisle Halloween Candy Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #header {
        background-color: #ff6600;
        color: #fff;
        text-align: center;
        font-family: Arial, sans-serif;
        font-size: 20px;
        font-weight: bold;
        padding: 10px;
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 10;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      }
      #refresh-btn {
        background-color: #fff;
        border: none;
        border-radius: 6px;
        padding: 6px 12px;
        font-size: 14px;
        cursor: pointer;
        margin-left: 10px;
      }
      #map {
        height: 100%;
        width: 100%;
        position: absolute;
        top: 50px;
        left: 0;
      }
      .gm-style-iw p { margin: 0; }
    </style>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkVmW-fM7yR9iVgoEZU8Kyhw54LeioIi0"></script>

    <script>
      let map;
      let kmlLayer;

      function initMap() {
        // Center on Carlisle, MA
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 42.529, lng: -71.35 },
          zoom: 14,
          mapTypeId: "roadmap",
        });

        loadKML();
      }

      function loadKML() {
        const kmlUrl = "https://drive.google.com/uc?export=download&id=17uU8PbDkT_S0sYOHvdY3EHxWP9l-YLGK";

        // Remove any existing KML layer first
        if (kmlLayer) {
          kmlLayer.setMap(null);
        }

        kmlLayer = new google.maps.KmlLayer({
          url: kmlUrl,
          map: map,
          preserveViewport: false,
          suppressInfoWindows: false,
        });

        kmlLayer.addListener("status_changed", () => {
          const status = kmlLayer.getStatus();
          if (status !== "OK") {
            alert("‚ö†Ô∏è Could not load map data. Make sure the KML file is shared publicly.");
          }
        });
      }

      function refreshMap() {
        loadKML();
      }

      window.onload = initMap;
    </script>
  </head>
  <body>
    <div id="header">
      üéÉ Carlisle Halloween Candy Map
      <button id="refresh-btn" onclick="refreshMap()">Refresh Map</button>
    </div>
    <div id="map"></div>
  </body>
</html>
